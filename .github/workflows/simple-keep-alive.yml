# ç®€åŒ–ç‰ˆæœ¬çš„ keep-alive å·¥ä½œæµï¼Œç”¨äºæµ‹è¯•
name: ğŸš€ Simple Keep Alive

on:
  # æ¯å°æ—¶è¿è¡Œä¸€æ¬¡ï¼ˆæ›´åˆç†çš„é¢‘ç‡ï¼‰
  schedule:
    - cron: '0 * * * *'
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

permissions:
  contents: read

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    name: Keep Site Alive
    
    steps:
      - name: ğŸ”¥ Warm Up Key Pages
        run: |
          # è®¾ç½®ç½‘ç«™ URLï¼ˆå¦‚æœæ²¡æœ‰è®¾ç½® secretï¼Œä½¿ç”¨é»˜è®¤å€¼ï¼‰
          SITE_URL="${{ secrets.CLOUDFLARE_PAGES_URL }}"
          if [ -z "$SITE_URL" ]; then
            SITE_URL="https://www.dinosawmachine.com"
          fi
          
          echo "ğŸŒ Warming up site: $SITE_URL"
          
          # è¦é¢„çƒ­çš„å…³é”®é¡µé¢
          PAGES=(
            "/"
            "/Products"
            "/blog"
            "/About-us"
            "/contact"
            "/Products/wire-saw-machine"
            "/Products/diamond-tools"
          )
          
          SUCCESS=0
          TOTAL=${#PAGES[@]}
          
          for page in "${PAGES[@]}"; do
            URL="$SITE_URL$page"
            echo "ğŸ”¥ Warming: $URL"
            
            # å‘é€è¯·æ±‚å¹¶è·å–çŠ¶æ€ç 
            STATUS=$(curl -s -o /dev/null -w "%{http_code}" \
              --max-time 30 \
              --retry 2 \
              --user-agent "GitHub-Actions-Keep-Alive/1.0" \
              "$URL" || echo "000")
            
            if [ "$STATUS" -ge 200 ] && [ "$STATUS" -lt 400 ]; then
              echo "  âœ… Success: $STATUS"
              SUCCESS=$((SUCCESS + 1))
            else
              echo "  âŒ Failed: $STATUS"
            fi
            
            # çŸ­æš‚å»¶è¿Ÿ
            sleep 2
          done
          
          echo ""
          echo "ğŸ“Š Results: $SUCCESS/$TOTAL pages warmed successfully"
          
          # å¦‚æœæˆåŠŸç‡ä½äº 50%ï¼Œæ ‡è®°ä¸ºå¤±è´¥
          if [ $SUCCESS -lt $((TOTAL / 2)) ]; then
            echo "âŒ Too many failures, marking as failed"
            exit 1
          else
            echo "âœ… Keep alive completed successfully"
          fi